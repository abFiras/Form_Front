<div class="login-particles"></div>

<button class="back-home" (click)="goHome()">
  <i class="fas fa-arrow-left"></i>
</button>

<div class="login-container">
  <div class="login-header">
    <div class="login-logo">
      <span class="logo-main">D&S</span>
      <span class="logo-sub">GROUPE</span>
    </div>
    <h1 class="login-title" *ngIf="step === 'request'">Mot de passe oublié</h1>
    <h1 class="login-title" *ngIf="step === 'reset'">Nouveau mot de passe</h1>
  </div>

  <!-- Étape 1: Demande de réinitialisation -->
  <form class="login-form" [formGroup]="resetPasswordForm" (ngSubmit)="onSubmit()" *ngIf="step === 'request'">
    <div class="form-description">
      <p>Saisissez votre adresse email et nous vous enverrons un lien pour réinitialiser votre mot de passe.</p>
    </div>

    <!-- Email -->
    <div class="form-group">
      <label for="email">Adresse email</label>
      <div class="input-wrapper">
        <input
          type="email"
          id="email"
          name="email"
          class="form-input"
          placeholder="votre@email.com"
          formControlName="email"
          required>
        <i class="fas fa-envelope input-icon"></i>
      </div>
      <div class="error-text" *ngIf="resetPasswordForm.get('email')?.invalid && resetPasswordForm.get('email')?.touched">
        <span *ngIf="resetPasswordForm.get('email')?.errors?.['required']">L'adresse email est requise</span>
        <span *ngIf="resetPasswordForm.get('email')?.errors?.['email']">Veuillez saisir une adresse email valide</span>
      </div>
    </div>

    <!-- Submit button -->
    <button type="submit" class="login-btn" [class.loading]="loading" [disabled]="resetPasswordForm.invalid || loading">
      <span class="btn-text">Envoyer le lien de réinitialisation</span>
      <div class="spinner">
        <i class="fas fa-spinner"></i>
      </div>
    </button>

    <!-- Back to login -->
    <div class="back-to-login">
      <a (click)="goToLogin()" class="back-link">
        <i class="fas fa-arrow-left"></i>
        Retour à la connexion
      </a>
    </div>
  </form>

  <!-- Étape 2: Réinitialisation du mot de passe -->
  <form class="login-form" [formGroup]="resetPasswordForm" (ngSubmit)="onSubmit()" *ngIf="step === 'reset'">
    <div class="form-description">
      <p>Choisissez un nouveau mot de passe sécurisé pour votre compte.</p>
    </div>

    <!-- New Password -->
    <div class="form-group">
      <label for="password">Nouveau mot de passe</label>
      <div class="input-wrapper">
        <input
          [type]="hidePassword ? 'password' : 'text'"
          id="password"
          name="password"
          class="form-input"
          placeholder="Votre nouveau mot de passe"
          formControlName="password"
          required>
        <i class="fas fa-lock input-icon"></i>
        <button type="button" class="password-toggle" (click)="togglePasswordVisibility('password')">
          <i class="fas" [ngClass]="hidePassword ? 'fa-eye' : 'fa-eye-slash'"></i>
        </button>
      </div>
      <div class="error-text" *ngIf="resetPasswordForm.get('password')?.invalid && resetPasswordForm.get('password')?.touched">
        <span *ngIf="resetPasswordForm.get('password')?.errors?.['required']">Le mot de passe est requis</span>
        <span *ngIf="resetPasswordForm.get('password')?.errors?.['minlength']">Le mot de passe doit contenir au moins 6 caractères</span>
      </div>
    </div>

    <!-- Confirm Password -->
    <div class="form-group">
      <label for="confirmPassword">Confirmer le mot de passe</label>
      <div class="input-wrapper">
        <input
          [type]="hideConfirmPassword ? 'password' : 'text'"
          id="confirmPassword"
          name="confirmPassword"
          class="form-input"
          placeholder="Confirmez votre mot de passe"
          formControlName="confirmPassword"
          required>
        <i class="fas fa-lock input-icon"></i>
        <button type="button" class="password-toggle" (click)="togglePasswordVisibility('confirmPassword')">
          <i class="fas" [ngClass]="hideConfirmPassword ? 'fa-eye' : 'fa-eye-slash'"></i>
        </button>
      </div>
      <div class="error-text" *ngIf="resetPasswordForm.get('confirmPassword')?.invalid && resetPasswordForm.get('confirmPassword')?.touched">
        <span *ngIf="resetPasswordForm.get('confirmPassword')?.errors?.['required']">La confirmation est requise</span>
        <span *ngIf="resetPasswordForm.get('confirmPassword')?.errors?.['passwordMismatch']">Les mots de passe ne correspondent pas</span>
      </div>
    </div>

    <!-- Password strength indicator -->
    <div class="password-strength" *ngIf="resetPasswordForm.get('password')?.value">
      <div class="strength-bar">
        <div class="strength-fill" [ngClass]="getPasswordStrengthClass()"></div>
      </div>
      <span class="strength-text">{{ getPasswordStrengthText() }}</span>
    </div>

    <!-- Submit button -->
    <button type="submit" class="login-btn" [class.loading]="loading" [disabled]="resetPasswordForm.invalid || loading">
      <span class="btn-text">Réinitialiser le mot de passe</span>
      <div class="spinner">
        <i class="fas fa-spinner"></i>
      </div>
    </button>

    <!-- Back to login -->
    <div class="back-to-login">
      <a (click)="goToLogin()" class="back-link">
        <i class="fas fa-arrow-left"></i>
        Retour à la connexion
      </a>
    </div>
  </form>
</div>
